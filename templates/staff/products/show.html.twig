{% extends 'staff/staff_base.html.twig' %}

{% block title %}{{ product.name }} - Staff Dashboard - CORK{% endblock %}

{% block page_title %}{{ product.name }}{% endblock %}

{% block content %}
<div class="product-container">
    <!-- Back Button -->
    <a href="{{ path('staff_products_index') }}" class="product-breadcrumb">
        ‚Üê Back to Products
    </a>

    <div class="product-layout">
        <!-- Product Image -->
        <div class="product-image-container">
            {% if product.image %}
                <img 
                    src="{{ asset('assets/images/wine_images/' ~ product.image) }}" 
                    alt="{{ product.name }}"
                    class="product-image"
                />
            {% else %}
                <div class="product-image-placeholder">
                    üç∑
                </div>
            {% endif %}
        </div>

        <!-- Product Details -->
        <div>
            <!-- Product Info Card -->
            <div class="product-details-card">
                <h2 class="product-title">
                    {{ product.name }}
                </h2>

                <!-- Price -->
                <div class="product-price-section">
                    <span class="product-price">‚Ç±{{ product.price|number_format(2) }}</span>
                </div>

                <!-- Description -->
                <div class="product-section">
                    <h4 class="product-section-label">
                        Description
                    </h4>
                    <p class="product-section-text">
                        {{ product.description }}
                    </p>
                </div>

                <!-- Info Grid -->
                <div class="product-info-grid">
                    <!-- Category -->
                    <div>
                        <label class="product-info-item-label">
                            Category
                        </label>
                        <div class="product-info-item-value">
                            {{ product.category.name }}
                        </div>
                    </div>

                    <!-- Created Date -->
                    <div>
                        <label class="product-info-item-label">
                            Created
                        </label>
                        <div class="product-info-item-value">
                            {{ product.createdAt|date('M d, Y') }}
                        </div>
                    </div>

                    <!-- Ownership Status -->
                    {% if not is_own_product %}
                        <div class="product-stock-alert">
                            <label class="product-stock-alert-label">
                                Status
                            </label>
                            <div class="product-stock-alert-value">
                                üìå Created by Admin
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Action Buttons -->
            {% if is_own_product %}
                <div class="product-actions">
                    <a 
                        href="{{ path('staff_products_edit', {'id': product.id}) }}"
                        class="btn-edit"
                    >
                        ‚úèÔ∏è Edit Product
                    </a>
                    <form method="POST" action="{{ path('staff_products_delete', {'id': product.id}) }}" style="flex: 1;" onsubmit="return confirm('Are you sure you want to delete this product?');">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ product.id) }}"/>
                        <button 
                            type="submit"
                            class="btn-delete"
                        >
                            üóëÔ∏è Delete Product
                        </button>
                    </form>
                </div>
            {% else %}
                <div class="product-view-only">
                    üîí View Only - This product was created by the admin and cannot be edited or deleted
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Related Inventory Section -->
    {% if product.wineInventories|length > 0 %}
        <div class="product-inventory-section">
            <h3 class="product-inventory-title">
                üì¶ Inventory Records ({{ product.wineInventories|length }})
            </h3>

            <div class="inventory-table-wrapper">
                <table class="inventory-table">
                    <thead>
                        <tr>
                            <th>Quantity</th>
                            <th>Acquired Date</th>
                            <th>Last Updated</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for inventory in product.wineInventories %}
                            <tr>
                                <td>{{ inventory.quantity }} units</td>
                                <td>
                                    {{ inventory.acquiredDate ? inventory.acquiredDate|date('M d, Y') : 'N/A' }}
                                </td>
                                <td>
                                    {{ inventory.lastUpdated|date('M d, Y') }}
                                </td>
                                <td>
                                    <a 
                                        href="{{ path('staff_inventory_show', {'id': inventory.id}) }}"
                                        class="inventory-edit-link"
                                    >
                                        View ‚Üí
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}
