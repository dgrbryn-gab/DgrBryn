{% extends 'staff/staff_base.html.twig' %}

{% block title %}My Products - Staff Dashboard - CORK{% endblock %}

{% block page_title %}My Products{% endblock %}

{% block content %}
<style>
    .product-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        border-left: 4px solid #7F1734;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        transition: all 0.3s ease;
        display: flex;
        gap: 20px;
    }

    .product-card:hover {
        box-shadow: 0 4px 12px rgba(127, 23, 52, 0.15);
        transform: translateY(-2px);
    }

    .product-image-container {
        width: 120px !important;
        height: 120px !important;
        min-width: 120px !important;
        min-height: 120px !important;
        max-width: 120px !important;
        max-height: 120px !important;
        border-radius: 8px;
        overflow: hidden;
        flex-shrink: 0;
        background: #f5f5f5;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .product-image {
        width: 100% !important;
        height: 100% !important;
        object-fit: contain;
        object-position: center;
    }

    .product-info {
        flex: 1;
    }

    .product-name {
        font-size: 18px;
        font-weight: 700;
        color: #7F1734;
        margin-bottom: 8px;
    }

    .product-description {
        font-size: 14px;
        color: #666;
        margin-bottom: 12px;
        line-height: 1.5;
    }

    .product-meta {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 12px;
        margin-bottom: 12px;
        font-size: 13px;
    }

    .meta-item {
        color: #888;
    }

    .meta-label {
        font-weight: 600;
        color: #7F1734;
    }

    .action-btn {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
        margin-right: 8px;
        border: none;
        cursor: pointer;
    }

    .action-view {
        background: #7F1734;
        color: white;
    }

    .action-view:hover {
        background: #5E0B15;
        transform: translateY(-2px);
    }

    .action-edit {
        background: #9E2B47;
        color: white;
    }

    .action-edit:hover {
        background: #7F1734;
        transform: translateY(-2px);
    }

    .action-delete {
        background: #FFA500;
        color: white;
    }

    .action-delete:hover {
        background: #FF8C00;
        transform: translateY(-2px);
    }

    .search-section {
        background: white;
        padding: 24px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        margin-bottom: 30px;
    }

    .search-controls {
        display: grid;
        grid-template-columns: 1fr 1fr auto auto;
        gap: 12px;
        align-items: end;
    }

    @media (max-width: 768px) {
        .search-controls {
            grid-template-columns: 1fr;
        }

        .product-card {
            flex-direction: column;
        }

        .product-image-container {
            width: 100%;
            height: 200px;
            min-width: 100%;
            min-height: 200px;
            max-width: 100%;
            max-height: 200px;
        }
    }
</style>

<div class="products-filter-section">
    <!-- Search and Filter -->
    <div class="search-section">
        <form method="GET" action="{{ path('staff_products_index') }}" class="products-filter-form">
            <div class="search-controls">
                <div>
                    <label class="filter-field-label">
                        Search Products
                    </label>
                    <input 
                        type="text"
                        name="search"
                        placeholder="Product name or description..."
                        value="{{ search_term }}"
                        class="filter-field-input"
                    />
                </div>

                <div>
                    <label class="filter-field-label">
                        Category
                    </label>
                    <select 
                        name="category"
                        class="filter-field-input"
                    >
                        <option value="">All Categories</option>
                        {% for category in categories %}
                            <option value="{{ category.id }}" {% if category.id == selected_category %}selected{% endif %}>
                                {{ category.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <button 
                    type="submit"
                    style="padding: 10px 20px; background: #7F1734; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;
                    "
                    onmouseover="this.style.background='#5E0B15'"
                    onmouseout="this.style.background='#7F1734'"
                >
                    üîç Search
                </button>

                <a 
                    href="{{ path('staff_products_index') }}"
                    style="
                        padding: 10px 20px;
                        background: #f0f0f0;
                        color: #333;
                        border: none;
                        border-radius: 6px;
                        font-weight: 600;
                        cursor: pointer;
                        text-decoration: none;
                        transition: all 0.3s ease;
                    "
                    onmouseover="this.style.background='#e0e0e0'"
                    onmouseout="this.style.background='#f0f0f0'"
                >
                    ‚Üª Reset
                </a>
            </div>
        </form>
    </div>

    <!-- Add New Product Button -->
    <div style="margin-bottom: 30px;">
        <a 
            href="{{ path('staff_products_new') }}"
            style="
                display: inline-block;
                padding: 12px 24px;
                background: linear-gradient(135deg, #7F1734, #9E2B47);
                color: white;
                text-decoration: none;
                border-radius: 8px;
                font-weight: 600;
                transition: all 0.3s ease;
            "
            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 16px rgba(127, 23, 52, 0.3)'"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'"
        >
            ‚ûï Add New Product
        </a>
    </div>

    <!-- Products List -->
    {% if products|length > 0 %}
        {% for product in products %}
            <div class="product-card">
                <div class="product-image-container">
                    {% if product.image %}
                        <img 
                            src="{{ asset('assets/images/wine_images/' ~ product.image) }}" 
                            alt="{{ product.name }}"
                            class="product-image"
                        />
                    {% else %}
                        <div 
                            style="
                                width: 100%;
                                height: 100%;
                                background: linear-gradient(135deg, #7F1734, #9E2B47);
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: white;
                                font-size: 36px;
                            "
                        >
                            üç∑
                        </div>
                    {% endif %}
                </div>

                <div class="product-info">
                    <div class="product-name">{{ product.name }}</div>
                    
                    <div class="product-description">
                        {% if product.description|length > 150 %}
                            {{ product.description|slice(0, 150) }}...
                        {% else %}
                            {{ product.description }}
                        {% endif %}
                    </div>

                    <div class="product-meta">
                        <div class="meta-item">
                            <span class="meta-label">Price:</span> ‚Ç±{{ product.price|number_format(2) }}
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Category:</span> {{ product.category.name }}
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Created:</span> {{ product.createdAt|date('M d, Y') }}
                        </div>
                        {% if product.id not in own_product_ids %}
                            <div class="meta-item" style="color: #FFA500; font-weight: 600;">
                                üìå Created by Admin
                            </div>
                        {% endif %}
                    </div>

                    <div>
                        <a href="{{ path('staff_products_show', {'id': product.id}) }}" class="action-btn action-view">
                            üëÅÔ∏è View
                        </a>
                        
                        {% if product.id in own_product_ids %}
                            <a href="{{ path('staff_products_edit', {'id': product.id}) }}" class="action-btn action-edit">
                                ‚úèÔ∏è Edit
                            </a>
                            <form method="POST" action="{{ path('staff_products_delete', {'id': product.id}) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this product?');">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ product.id) }}"/>
                                <button type="submit" class="action-btn action-delete">
                                    üóëÔ∏è Delete
                                </button>
                            </form>
                        {% else %}
                            <span style="display: inline-block; padding: 8px 16px; border-radius: 6px; font-size: 12px; font-weight: 600; color: #999; background: #f0f0f0; cursor: not-allowed;">
                                üîí View Only
                            </span>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div style="
            background: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        ">
            <div style="font-size: 48px; margin-bottom: 16px;">üç∑</div>
            <h3 style="font-size: 20px; color: #7F1734; font-weight: 700; margin-bottom: 8px;">
                No Products Yet
            </h3>
            <p style="font-size: 14px; color: #888; margin-bottom: 20px;">
                You haven't created any products yet. Start by creating your first product!
            </p>
            <a 
                href="{{ path('staff_products_new') }}"
                style="
                    display: inline-block;
                    padding: 12px 24px;
                    background: linear-gradient(135deg, #7F1734, #9E2B47);
                    color: white;
                    text-decoration: none;
                    border-radius: 8px;
                    font-weight: 600;
                    transition: all 0.3s ease;
                "
                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 16px rgba(127, 23, 52, 0.3)'"
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'"
            >
                ‚ûï Create Your First Product
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}
