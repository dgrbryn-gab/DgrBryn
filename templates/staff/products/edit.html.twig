{% extends 'staff/staff_base.html.twig' %}

{% block title %}Edit Product - Staff Dashboard - CORK{% endblock %}

{% block page_title %}Edit Product{% endblock %}

{% block content %}
<div class="fixed top-0 left-64 right-0 bottom-0 flex items-center justify-center bg-slate-200/50 z-50">
    <div class="w-11/12 max-w-6xl bg-white/98 backdrop-blur-sm py-8 px-8 rounded-3xl shadow-2xl border border-[#EFCFB4] relative overflow-hidden">

        <!-- Top Accent Line -->
        <div class="absolute top-0 left-0 right-0 h-2 bg-gradient-to-r from-[#EFCFB4] via-[#9E2B47] to-[#7F1734] rounded-t-3xl"></div>

        <!-- Header -->
        <h1 class="text-4xl font-extrabold text-center text-[#7F1734] tracking-tight mb-6">
            üõçÔ∏è Edit {{ product.name }}
        </h1>

        {{ form_start(form, {
            'attr': {'class': 'grid grid-cols-1 md:grid-cols-2 gap-4'},
            'multipart': true
        }) }}

            <!-- Category and Product Name in Two Columns -->
            <!-- Category -->
            {% if form.category is defined %}
                <div class="col-span-1">
                    {{ form_label(form.category, 'Category', {
                        'label_attr': {'class': 'block text-sm font-semibold text-[#4B164C] mb-2 tracking-wide'}
                    }) }}
                    {{ form_widget(form.category, {
                        'attr': {
                            'class': 'w-full px-5 py-3 rounded-2xl bg-white border border-amber-200 shadow focus:ring-4 focus:ring-[#9E2B47]/40 focus:border-[#7F1734] text-gray-800 placeholder-gray-400 transition-all duration-300'
                        }
                    }) }}
                    {% if form_errors(form.category) %}
                        <p class="text-sm text-red-600 mt-1">{{ form_errors(form.category) }}</p>
                    {% endif %}
                </div>
            {% endif %}

            <!-- Product Name -->
            {% if form.name is defined %}
                <div class="col-span-1">
                    {{ form_label(form.name, 'Product Name', {
                        'label_attr': {'class': 'block text-sm font-semibold text-[#4B164C] mb-2 tracking-wide'}
                    }) }}
                    {{ form_widget(form.name, {
                        'attr': {
                            'class': 'w-full px-5 py-3 rounded-2xl bg-white border border-amber-200 shadow focus:ring-4 focus:ring-[#9E2B47]/40 focus:border-[#7F1734] text-gray-800 placeholder-gray-400 transition-all duration-300'
                        }
                    }) }}
                    {% if form_errors(form.name) %}
                        <p class="text-sm text-red-600 mt-1">{{ form_errors(form.name) }}</p>
                    {% endif %}
                </div>
            {% endif %}

            <!-- Description (Full Width) -->
            {% if form.description is defined %}
                <div class="col-span-1 md:col-span-2">
                    {{ form_label(form.description, 'Description', {
                        'label_attr': {'class': 'block text-sm font-semibold text-[#4B164C] mb-2 tracking-wide'}
                    }) }}
                    {{ form_widget(form.description, {
                        'attr': {
                            'class': 'w-full px-5 py-3 rounded-2xl bg-white border border-amber-200 shadow focus:ring-4 focus:ring-[#9E2B47]/40 focus:border-[#7F1734] text-gray-800 placeholder-gray-400 transition-all duration-300 min-h-[100px]'
                        }
                    }) }}
                    {% if form_errors(form.description) %}
                        <p class="text-sm text-red-600 mt-1">{{ form_errors(form.description) }}</p>
                    {% endif %}
                </div>
            {% endif %}

            <!-- Price and Initial Stock -->
            <!-- Price -->
            {% if form.price is defined %}
                <div class="col-span-1">
                    {{ form_label(form.price, 'Price', {
                        'label_attr': {'class': 'block text-sm font-semibold text-[#4B164C] mb-2 tracking-wide'}
                    }) }}
                    {{ form_widget(form.price, {
                        'attr': {
                            'class': 'w-full px-5 py-3 rounded-2xl bg-white border border-amber-200 shadow focus:ring-4 focus:ring-[#9E2B47]/40 focus:border-[#7F1734] text-gray-800 placeholder-gray-400 transition-all duration-300'
                        }
                    }) }}
                    {% if form_errors(form.price) %}
                        <p class="text-sm text-red-600 mt-1">{{ form_errors(form.price) }}</p>
                    {% endif %}
                </div>
            {% endif %}

            <!-- Initial Stock Quantity -->
            {% if form.quantity is defined %}
                <div class="col-span-1">
                    {{ form_label(form.quantity, 'Initial Stock', {
                        'label_attr': {'class': 'block text-sm font-semibold text-[#4B164C] mb-2 tracking-wide'}
                    }) }}
                    {{ form_widget(form.quantity, {
                        'attr': {
                            'class': 'w-full px-5 py-3 rounded-2xl bg-white border border-amber-200 shadow focus:ring-4 focus:ring-[#9E2B47]/40 focus:border-[#7F1734] text-gray-800 placeholder-gray-400 transition-all duration-300'
                        }
                    }) }}
                    {% if form_errors(form.quantity) %}
                        <p class="text-sm text-red-600 mt-1">{{ form_errors(form.quantity) }}</p>
                    {% endif %}
                </div>
            {% endif %}

            <!-- Image Upload with Preview (Full Width) -->
            {% if form.imageFile is defined %}
                <div class="col-span-1 md:col-span-2">
                    {{ form_label(form.imageFile, 'Product Image', {
                        'label_attr': {'class': 'block text-sm font-semibold text-[#4B164C] mb-2 tracking-wide'}
                    }) }}

                    <div class="flex items-center gap-4">
                        <!-- Current Image Preview -->
                        {% if product.image %}
                            <div class="flex flex-col items-center">
                                <span class="text-xs font-medium text-[#4B164C] mb-1">Current:</span>
                                <div class="bg-white p-1 rounded-lg border border-amber-200 shadow-sm">
                                    <img src="{{ asset('assets/images/wine_images/' ~ product.image) }}"
                                         alt="{{ product.name }}"
                                         class="h-20 w-auto rounded object-contain">
                                </div>
                            </div>
                        {% endif %}

                        <!-- File Input -->
                        <div class="flex-1">
                            {{ form_widget(form.imageFile, {
                                'attr': {
                                    'class': 'block w-full text-sm text-gray-700 file:mr-3 file:py-1.5 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-[#7F1734] file:text-[#F8EAD8] hover:file:bg-[#9E2B47] focus:ring-2 focus:ring-[#9E2B47]/40 cursor-pointer'
                                }
                            }) }}
                            <p class="text-xs text-gray-500 mt-1">Max 5 MB ‚Äì JPEG, PNG, WebP (optional)</p>
                        </div>
                    </div>

                    {% if form_errors(form.imageFile) %}
                        <p class="text-sm text-red-600 mt-2">{{ form_errors(form.imageFile) }}</p>
                    {% endif %}
                </div>
            {% endif %}

            <!-- Is Available Checkbox (Full Width) -->
            {% if form.isAvailable is defined %}
                <div class="col-span-1 md:col-span-2 flex items-center space-x-3 bg-[#F8EAD8]/20 px-5 py-3 rounded-2xl border border-amber-100">
                    {{ form_widget(form.isAvailable, {
                        'attr': {
                            'class': 'h-5 w-5 text-[#7F1734] border-gray-300 rounded focus:ring-[#9E2B47]'
                        }
                    }) }}
                    {{ form_label(form.isAvailable, 'Available for Sale', {
                        'label_attr': {'class': 'text-sm font-semibold text-[#4B164C] cursor-pointer'}
                    }) }}
                </div>
            {% endif %}

            {{ form_widget(form._token) }}

            <!-- Buttons Section -->
            <div class="col-span-1 md:col-span-2">
                <div class="flex justify-center gap-4 mt-2 pt-2 border-t border-amber-100">
                    <button type="submit"
                            class="px-6 py-2 rounded-xl shadow-lg font-semibold text-sm border transition-all duration-300 transform hover:scale-105 bg-[#7F1734] text-[#F8EAD8] border-[#EFCFB4] hover:bg-[#9E2B47] focus:ring-4 focus:ring-[#9E2B47]/40">
                        üíæ Save Changes
                    </button>
                    <a href="{{ path('staff_products_show', {'id': product.id}) }}"
                       class="px-6 py-2 rounded-xl shadow-md font-semibold text-sm border transition-all duration-300 transform hover:scale-105 bg-gray-200 text-gray-800 border-gray-300 hover:bg-gray-300 focus:ring-4 focus:ring-gray-400/40">
                        ‚Üê Cancel
                    </a>
                </div>
            </div>

        {{ form_end(form) }}
    </div>
</div>
{% endblock %}
