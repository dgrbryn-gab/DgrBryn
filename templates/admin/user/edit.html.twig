{% extends 'admin/admin_base.html.twig' %}

{% block title %}Edit User - CORK Admin{% endblock %}

{% block admin_header_display %}display: none;{% endblock %}

{% block admin_content %}
<div class="min-h-screen bg-[#4B164C] py-2 px-0">
    <div class="min-h-screen bg-[#4B164C]">
        <div class="fixed top-0 left-64 right-0 bottom-0 z-50 flex items-center justify-center modal-overlay">
            <div class="bg-white/95 backdrop-blur-lg py-8 px-6 rounded-3xl shadow-2xl border border-[#EFCFB4] relative overflow-hidden" style="position: fixed; width: 85%; max-width: 900px; max-height: 85vh; display: flex; flex-direction: column;">

                <!-- Top Accent Line -->
                <div class="absolute top-0 left-0 right-0 h-2 bg-gradient-to-r from-[#EFCFB4] via-[#9E2B47] to-[#7F1734] rounded-t-3xl"></div>

                <!-- Header -->
                <h1 class="text-3xl font-extrabold text-center text-[#7F1734] tracking-tight mb-1">
                    ‚úèÔ∏è Edit User
                </h1>
                <div class="text-center text-gray-600 text-xs mb-4 space-y-0.5">
                    <p><strong>Username:</strong> @{{ user.username }}</p>
                    <p><strong>Email:</strong> {{ user.email }}</p>
                </div>

                <!-- Scrollable Form Content -->
                <div style="flex: 1; overflow-y: auto; padding-right: 12px; margin-bottom: 12px;">
                    {{ form_start(form, {
                        'attr': {'class': 'space-y-4', 'novalidate': 'novalidate'}
                    }) }}

                    <!-- Username -->
                    <div>
                        {{ form_label(form.username, 'Username', {
                            'label_attr': {'class': 'block text-sm font-semibold text-[#4B164C] mb-2 tracking-wide'}
                        }) }}
                        {{ form_widget(form.username, {
                            'attr': {
                                'class': 'w-full px-4 py-3 rounded-xl bg-white border border-amber-200 shadow focus:ring-4 focus:ring-[#9E2B47]/40 focus:border-[#7F1734] text-gray-800 placeholder-gray-400 transition-all duration-300',
                                'placeholder': 'username',
                                'required': 'required'
                            }
                        }) }}
                        {% if form_errors(form.username) %}
                            <div class="text-sm text-red-600 mt-1">
                                {% for error in form_errors(form.username) %}
                                    <p>{{ error.message }}</p>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Email -->
                    <div>
                        {{ form_label(form.email, 'Email Address', {
                            'label_attr': {'class': 'block text-sm font-semibold text-[#4B164C] mb-2 tracking-wide'}
                        }) }}
                        {{ form_widget(form.email, {
                            'attr': {
                                'class': 'w-full px-4 py-3 rounded-xl bg-white border border-amber-200 shadow focus:ring-4 focus:ring-[#9E2B47]/40 focus:border-[#7F1734] text-gray-800 placeholder-gray-400 transition-all duration-300',
                                'placeholder': 'user@example.com',
                                'required': 'required'
                            }
                        }) }}
                        {% if form_errors(form.email) %}
                            <div class="text-sm text-red-600 mt-1">
                                {% for error in form_errors(form.email) %}
                                    <p>{{ error.message }}</p>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Role Selection -->
                    <div>
                        {{ form_label(form.roles, 'Select User Role', {
                            'label_attr': {'class': 'block text-sm font-semibold text-[#4B164C] mb-2 tracking-wide'}
                        }) }}
                        {{ form_widget(form.roles, {
                            'attr': {
                                'class': 'w-full px-4 py-3 rounded-xl bg-white border border-amber-200 shadow focus:ring-4 focus:ring-[#9E2B47]/40 focus:border-[#7F1734] text-gray-800 transition-all duration-300'
                            }
                        }) }}
                        {% if form_errors(form.roles) %}
                            <p class="text-sm text-red-600 mt-1">{{ form_errors(form.roles) }}</p>
                        {% endif %}
                        <p class="text-xs text-gray-600 mt-2 p-2 bg-blue-50 border border-blue-200 rounded-lg">
                            <strong>Roles:</strong> Admin (full access) | Staff (manage products/orders) | Customer (standard)
                        </p>
                    </div>

                    <!-- Password Section -->
                    <div class="bg-blue-50 border border-blue-200 rounded-xl p-3">
                        <p class="text-xs text-blue-700 mb-3">üí° Leave empty to keep current password</p>
                        
                        <!-- Password Fields in 2 Columns -->
                        <div class="grid grid-cols-2 gap-3">
                            <!-- Password -->
                            <div>
                                {{ form_label(form.plainPassword.first, 'New Password (Optional)', {
                                    'label_attr': {'class': 'block text-xs font-semibold text-[#4B164C] mb-1 tracking-wide'}
                                }) }}
                                {{ form_widget(form.plainPassword.first, {
                                    'attr': {
                                        'class': 'w-full px-3 py-2 rounded-lg bg-white border border-amber-200 shadow focus:ring-3 focus:ring-[#9E2B47]/40 focus:border-[#7F1734] text-gray-800 placeholder-gray-400 transition-all duration-300 text-sm',
                                        'placeholder': 'Min 6 chars'
                                    }
                                }) }}
                                {% if form_errors(form.plainPassword.first) %}
                                    <div class="text-xs text-red-600 mt-1">
                                        {% for error in form_errors(form.plainPassword.first) %}
                                            <p>{{ error.message }}</p>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Confirm Password -->
                            <div>
                                {{ form_label(form.plainPassword.second, 'Confirm Password (Optional)', {
                                    'label_attr': {'class': 'block text-xs font-semibold text-[#4B164C] mb-1 tracking-wide'}
                                }) }}
                                {{ form_widget(form.plainPassword.second, {
                                    'attr': {
                                        'class': 'w-full px-3 py-2 rounded-lg bg-white border border-amber-200 shadow focus:ring-3 focus:ring-[#9E2B47]/40 focus:border-[#7F1734] text-gray-800 placeholder-gray-400 transition-all duration-300 text-sm',
                                        'placeholder': 'Re-enter'
                                    }
                                }) }}
                                {% if form_errors(form.plainPassword.second) %}
                                    <div class="text-xs text-red-600 mt-1">
                                        {% for error in form_errors(form.plainPassword.second) %}
                                            <p>{{ error.message }}</p>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Metadata -->
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-2 text-xs text-gray-600 space-y-0.5">
                        <p><strong>Created:</strong> {{ user.createdAt ? user.createdAt|date('M d, Y H:i') : 'N/A' }}</p>
                        {% if user.updatedAt %}
                            <p><strong>Updated:</strong> {{ user.updatedAt|date('M d, Y H:i') }}</p>
                        {% endif %}
                    </div>

                    <!-- Buttons (Inside Form) -->
                    <div class="flex gap-3 justify-center pt-3 border-t border-gray-200">
                        <a href="{{ path('admin_users_index') }}"
                            class="px-4 py-2 rounded-lg font-semibold text-sm text-[#4B164C] border border-[#EFCFB4] bg-white hover:bg-gray-100 transition-all duration-300">
                            ‚úï Cancel
                        </a>
                        <button type="submit" class="px-6 py-2 rounded-lg font-semibold text-sm text-[#7F1734] bg-gradient-to-r from-[#EFCFB4] to-[#D4AF9A] hover:from-[#D4AF9A] hover:to-[#B89480] shadow-lg transition-all duration-300">
                            ‚úì Update User
                        </button>
                    </div>

                    {{ form_end(form) }}
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
