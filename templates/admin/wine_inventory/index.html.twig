{% extends 'admin/admin_base.html.twig' %}

{% block title %}Wine Inventory | Wine Store{% endblock %}

{% block admin_content %}
<div class="min-h-screen bg-gradient-to-b from-rose-50 to-amber-50 py-12 px-6">
    <div class="max-w-6xl mx-auto">

        <!-- Flash Messages -->
        {% for message in app.flashes('success') %}
            <div class="mb-6 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg" role="alert">
                ‚úì {{ message }}
            </div>
        {% endfor %}

        {% for message in app.flashes('error') %}
            <div class="mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg" role="alert">
                ‚úï {{ message }}
            </div>
        {% endfor %}

        <!-- ‚úÖ Page Title -->
    <h1 class="text-3xl font-bold mb-6 text-left text-[#7F1734]">Wine Inventory</h1>

        <!-- ‚úÖ Search and Category Row -->
        <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-10">

            <!-- üîç Search Bar (Left, below title) -->
            <form method="get" action="{{ path('app_wine_inventory_index') }}" class="flex items-center space-x-3 mb-4 md:mb-0">
                <input type="text"
                       name="search"
                       value="{{ search_term|default('') }}"
                       placeholder="Search product..."
                       class="border border-gray-300 rounded-lg py-2 px-4 w-64 focus:ring-2 focus:ring-[#7F1734] focus:outline-none text-gray-700"
                       />
        <button type="submit"
            class="px-5 py-2 rounded-lg font-semibold transition-all duration-300 bg-[#7F1734] text-[#F8EAD8] border border-[#f4e7ce] hover:bg-[#9E2B47] btn-hover">
                    üîç Search
                </button>
            </form>

            <!-- üìÇ Category Filter (Right Side) -->
            {% if categories is defined and categories is not empty %}
                <form method="get" action="{{ path('app_wine_inventory_index') }}" class="flex items-center space-x-3">
                    <label for="category" class="text-gray-700 font-medium">Filter by Category:</label>
                    <select name="category" id="category"
                            class="border border-gray-300 rounded-lg py-2 px-4 focus:ring-2 focus:ring-[#7F1734] focus:outline-none text-gray-700">
                        <option value="">All Categories</option>
                        {% for category in categories %}
                            <option value="{{ category.id }}"
                                {% if selected_category == category.id %}selected{% endif %}>
                                {{ category.name }}
                            </option>
                        {% endfor %}
                    </select>
                    <button type="submit"
                            class="px-5 py-2 rounded-lg font-semibold transition-all duration-300 bg-[#7F1734] text-[#F8EAD8] border border-[#f4e7ce] hover:bg-[#9E2B47] btn-hover">
                        Apply
                    </button>
                </form>
            {% endif %}
        </div>

        {% if grouped_inventories is defined and grouped_inventories|length > 0 %}
            {% for category, inventories in grouped_inventories %}
                <div class="mb-12">
                    <h2 class="text-2xl font-bold mb-6 border-b-4 pb-2 text-[#7F1734] border-[#f9d3b4]">
                            {{ category }}
                        </h2>

                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                        {% for wine_inventory in inventories %}
                            <div class="bg-white rounded-2xl shadow-lg border border-rose-100 overflow-hidden hover:shadow-2xl transition-all duration-300 flex flex-col">
                                
                                <div class="bg-[#7F1734] text-[#f9d3b4] px-5 py-3 flex justify-between items-center">
                                    <h3 class="text-lg font-bold truncate">{{ wine_inventory.product.name }}</h3>
                                    <span class="text-sm bg-[#f9d3b4] text-[#7F1734] font-semibold px-2 py-1 rounded-md">
                                        ID: {{ wine_inventory.id }}
                                    </span>
                                </div>

                                <div class="p-5 flex-grow flex flex-col justify-between">
                                    <div class="w-full h-56 flex items-center justify-center bg-rose-50 rounded-xl overflow-hidden">
                                        {% if wine_inventory.product.image %}
                                            <img src="{{ asset('assets/images/wine_images/' ~ wine_inventory.product.image) }}"
                                                 alt="{{ wine_inventory.product.name }}"
                                                 class="max-h-56 object-contain rounded-xl">
                                        {% else %}
                                            <img src="{{ asset('images/no-image.png') }}"
                                                 alt="No image available"
                                                 class="max-h-56 object-contain rounded-xl opacity-70">
                                        {% endif %}
                                    </div>

                                    <div class="mt-4 space-y-2 text-gray-700 text-sm">
                                        <p><span class="font-semibold text-[#7F1734]">Quantity:</span> {{ wine_inventory.quantity }}</p>
                                        <p><span class="font-semibold text-[#7F1734]">Acquired:</span> {{ wine_inventory.acquiredDate ? wine_inventory.acquiredDate|date('F j, Y') : 'N/A' }}</p>
                                        <p><span class="font-semibold text-[#7F1734]">Last Updated:</span> {{ wine_inventory.lastUpdated ? wine_inventory.lastUpdated|date('F j, Y, g:i a') : 'N/A' }}</p>
                                    </div>
                                </div>

                                <div class="px-5 py-4 flex justify-center gap-3 border-t border-rose-100 bg-burgundy">
                                    <a href="{{ path('app_wine_inventory_show', {'id': wine_inventory.id}) }}"
                                       class="flex-1 text-center font-semibold rounded-xl shadow-md transition-all duration-300 flex items-center justify-center bg-[#f9d3b4] text-[#7F1734] border border-[#f4e7ce] min-h-[42px] hover:bg-[#e9c09e] btn-hover">
                                        Show
                                    </a>
                                    <a href="{{ path('app_wine_inventory_edit', {'id': wine_inventory.id}) }}"
                                       class="flex-1 text-center font-semibold rounded-xl shadow-md transition-all duration-300 flex items-center justify-center bg-[#a83244] text-[#f4e7ce] border border-[#f9d3b4] min-h-[42px] hover:bg-[#8b1e2d] btn-hover">
                                        Edit
                                    </a>
                                    {{ include('admin/wine_inventory/_delete_form.html.twig', {
                                        'wine_inventory': wine_inventory,
                                        'attr': {'class': 'inline-block flex-1'}
                                    }) }}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="bg-white rounded-2xl shadow-lg border border-rose-100 p-8 text-center text-gray-600">
                No records found.
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
