{% extends 'admin/admin_base.html.twig' %}

{% block title %}Edit Order {{ order.orderNumber }} - CORK Admin{% endblock %}

{% block admin_content %}

<div class="min-h-screen bg-gradient-to-b from-[#FFF8F0] to-[#F8EAD8] py-14 px-6">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="flex flex-col sm:flex-row justify-between items-start gap-6 mb-8">
            <div>
                <h1 class="text-4xl font-extrabold text-[#5E0B15] tracking-tight mb-2">Edit Order {{ order.orderNumber }}</h1>
                <p class="text-gray-600">Update order details and items.</p>
            </div>
            <div class="flex flex-col gap-2 w-full sm:w-auto">
                <a href="{{ path('app_order_show', {'id': order.id}) }}"
                    class="px-6 py-2 rounded-xl font-semibold shadow-md transition-all duration-300 border text-center bg-[#EFCFB4] text-[#7F1734] border-[#EFCFB4] hover:bg-[#7F1734] hover:text-white btn-hover">
                    üëÅÔ∏è View Order
                </a>
                <a href="{{ path('app_order_index') }}"
                    class="px-6 py-2 rounded-xl font-semibold shadow-md transition-all duration-300 border text-center bg-gray-300 text-gray-700 border-gray-300 hover:bg-gray-400 btn-hover">
                    ‚Üê Back
                </a>
            </div>
        </div>

        <!-- Order Details Form -->
        <div class="bg-white/90 backdrop-blur-sm border border-[#EFCFB4]/50 rounded-2xl shadow-md p-8 mb-8">
            {{ form_start(form, {'attr': {'class': 'space-y-6'}}) }}

            <!-- Customer Information Section -->
            <fieldset class="border-l-4 border-[#EFCFB4] pl-6 py-4">
                <legend class="text-lg font-bold text-[#5E0B15] mb-4">Customer Information</legend>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        {{ form_row(form.customerName, {'attr': {'class': 'form-control'}}) }}
                    </div>
                    <div>
                        {{ form_row(form.customerEmail, {'attr': {'class': 'form-control'}}) }}
                    </div>
                    <div class="md:col-span-2">
                        {{ form_row(form.customerPhone, {'attr': {'class': 'form-control'}}) }}
                    </div>
                </div>
            </fieldset>

            <!-- Shipping & Billing Section -->
            <fieldset class="border-l-4 border-[#EFCFB4] pl-6 py-4">
                <legend class="text-lg font-bold text-[#5E0B15] mb-4">Addresses</legend>
                
                <div class="space-y-6">
                    <div>
                        {{ form_row(form.shippingAddress, {'attr': {'rows': 4, 'class': 'form-control'}}) }}
                    </div>
                    <div>
                        {{ form_row(form.billingAddress, {'attr': {'rows': 4, 'class': 'form-control'}}) }}
                    </div>
                </div>
            </fieldset>

            <!-- Order Status Section -->
            <fieldset class="border-l-4 border-[#EFCFB4] pl-6 py-4">
                <legend class="text-lg font-bold text-[#5E0B15] mb-4">Order Status</legend>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        {{ form_row(form.status, {'attr': {'class': 'form-control'}}) }}
                    </div>
                    <div>
                        {{ form_row(form.paymentStatus, {'attr': {'class': 'form-control'}}) }}
                    </div>
                </div>
            </fieldset>

            <!-- Payment Section -->
            <fieldset class="border-l-4 border-[#EFCFB4] pl-6 py-4">
                <legend class="text-lg font-bold text-[#5E0B15] mb-4">Payment Information</legend>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        {{ form_row(form.paymentMethod, {'attr': {'class': 'form-control'}}) }}
                    </div>
                    <div>
                        {{ form_row(form.shippingCost, {'attr': {'class': 'form-control'}}) }}
                    </div>
                    <div>
                        {{ form_row(form.taxAmount, {'attr': {'class': 'form-control'}}) }}
                    </div>
                    <div>
                        {{ form_row(form.discountAmount, {'attr': {'class': 'form-control'}}) }}
                    </div>
                </div>
            </fieldset>

            <!-- Notes Section -->
            <fieldset class="border-l-4 border-[#EFCFB4] pl-6 py-4">
                <legend class="text-lg font-bold text-[#5E0B15] mb-4">Additional Notes</legend>
                
                {{ form_row(form.notes, {'attr': {'rows': 5, 'class': 'form-control'}}) }}
            </fieldset>

            <!-- Form Actions -->
            <div class="flex gap-4 pt-4 border-t border-gray-200">
                <button type="submit"
                    class="px-8 py-3 rounded-xl font-semibold shadow-md transition-all duration-300 border bg-[#EFCFB4] text-[#7F1734] border-[#EFCFB4] hover:bg-[#7F1734] hover:text-white btn-hover">
                    ‚úì Update Order
                </button>
                <a href="{{ path('app_order_show', {'id': order.id}) }}"
                    class="px-8 py-3 rounded-xl font-semibold shadow-md transition-all duration-300 border bg-gray-300 text-gray-700 border-gray-300 hover:bg-gray-400 btn-hover text-center">
                    Cancel
                </a>
            </div>

            {{ form_end(form) }}
        </div>

        <!-- Order Items Section -->
        <div class="bg-white/90 backdrop-blur-sm border border-[#EFCFB4]/50 rounded-2xl shadow-md p-8 mb-8">
            <h2 class="text-2xl font-bold text-[#5E0B15] mb-6">Order Items</h2>

            {% if order.orderItems|length > 0 %}
                <div class="overflow-x-auto mb-8">
                    <table class="w-full">
                        <thead>
                            <tr class="bg-[#F8EAD8] border-b border-[#EFCFB4]">
                                <th class="px-4 py-2 text-left text-sm font-semibold">Product</th>
                                <th class="px-4 py-2 text-center text-sm font-semibold">Unit Price</th>
                                <th class="px-4 py-2 text-center text-sm font-semibold">Quantity</th>
                                <th class="px-4 py-2 text-right text-sm font-semibold">Subtotal</th>
                                <th class="px-4 py-2 text-center text-sm font-semibold">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in order.orderItems %}
                                <tr class="border-t border-[#EFCFB4]/30 hover:bg-[#F8EAD8]/50 transition-colors">
                                    <td class="px-4 py-3 text-sm text-gray-700">
                                        {{ item.product.name }}
                                    </td>
                                    <td class="px-4 py-3 text-sm text-center text-gray-700">
                                        ‚Ç±{{ item.unitPrice }}
                                    </td>
                                    <td class="px-4 py-3 text-sm text-center text-gray-700">
                                        {{ item.quantity }}
                                    </td>
                                    <td class="px-4 py-3 text-sm text-right font-semibold text-gray-800">
                                        ‚Ç±{{ item.subtotal }}
                                    </td>
                                    <td class="px-4 py-3 text-center">
                                        <form method="post" action="{{ path('app_order_remove_item', {'orderId': order.id, 'itemId': item.id}) }}" onsubmit="return confirm('Remove this item?');" class="inline">
                                            <input type="hidden" name="_token" value="{{ csrf_token('remove_item' ~ item.id) }}">
                                            <button type="submit" class="px-3 py-1 rounded text-xs font-semibold bg-red-100 text-red-700 hover:bg-red-200 transition-all duration-300">
                                                üóëÔ∏è Remove
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p class="text-gray-600 text-center py-8 mb-8">No items in this order yet.</p>
            {% endif %}

            <!-- Add Item Section -->
            <fieldset class="border-t border-gray-200 pt-6">
                <legend class="text-lg font-bold text-[#5E0B15] mb-4">Add Item to Order</legend>
                
                <form method="post" action="{{ path('app_order_add_item', {'id': order.id}) }}" class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                    <div>
                        <label class="block text-sm font-semibold text-[#5E0B15] mb-2">Product</label>
                        <select name="product_id" class="form-control" required>
                            <option value="">-- Select a product --</option>
                            <!-- Products will be populated via JavaScript or loaded from backend -->
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-[#5E0B15] mb-2">Quantity</label>
                        <input type="number" name="quantity" value="1" min="1" class="form-control" required>
                    </div>
                    <div>
                        <button type="submit" class="w-full px-6 py-2 rounded-lg font-semibold bg-[#EFCFB4] text-[#7F1734] border border-[#EFCFB4] hover:bg-[#7F1734] hover:text-white transition-all duration-300">
                            + Add Item
                        </button>
                    </div>
                </form>
            </fieldset>
        </div>
    </div>
</div>

<style>
    .form-control {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #EFCFB4;
        border-radius: 0.5rem;
        font-size: 1rem;
        transition: border-color 0.3s, box-shadow 0.3s;
    }

    .form-control:focus {
        outline: none;
        border-color: #7F1734;
        box-shadow: 0 0 0 3px rgba(127, 23, 52, 0.1);
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #5E0B15;
        font-size: 0.95rem;
    }
</style>

{% endblock %}
