{% extends 'admin/admin_base.html.twig' %}

{% block title %}Edit Order {{ order.orderNumber }} - CORK Admin{% endblock %}

{% block admin_content %}

<div class="min-h-screen bg-gradient-to-b from-[#FFF8F0] to-[#F8EAD8] py-14 px-6">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="flex flex-col sm:flex-row justify-between items-start gap-6 mb-8">
            <div>
                <h1 class="text-4xl font-extrabold text-[#5E0B15] tracking-tight mb-2">üìã Edit Order {{ order.orderNumber }}</h1>
                <p class="text-gray-600">Update order details and items.</p>
            </div>
            <div class="flex flex-col gap-2 w-full sm:w-auto">
                <a href="{{ path('app_order_show', {'id': order.id}) }}"
                    class="px-6 py-2 rounded-xl font-semibold shadow-md transition-all duration-300 border text-center bg-[#EFCFB4] text-[#7F1734] border-[#EFCFB4] hover:bg-[#7F1734] hover:text-white btn-hover">
                    üëÅÔ∏è View Order
                </a>
                <a href="{{ path('app_order_index') }}"
                    class="px-6 py-2 rounded-xl font-semibold shadow-md transition-all duration-300 border text-center bg-gray-300 text-gray-700 border-gray-300 hover:bg-gray-400 btn-hover">
                    ‚Üê Back
                </a>
            </div>
        </div>

        <!-- Order Details Form -->
        <div class="bg-white/90 backdrop-blur-sm border border-[#EFCFB4]/50 rounded-2xl shadow-md p-8 mb-8">
            {{ form_start(form, {'attr': {'class': 'space-y-6'}}) }}

            <!-- Customer Information Section -->
            <fieldset class="fieldset-section">
                <legend class="section-legend">Customer Information</legend>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        {{ form_label(form.customerName, null, {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.customerName, {'attr': {'class': 'form-control'}}) }}
                    </div>
                    <div>
                        {{ form_label(form.customerEmail, null, {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.customerEmail, {'attr': {'class': 'form-control'}}) }}
                    </div>
                    <div class="md:col-span-2">
                        {{ form_label(form.customerPhone, null, {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.customerPhone, {'attr': {'class': 'form-control'}}) }}
                    </div>
                </div>
            </fieldset>

            <!-- Shipping & Billing Section -->
            <fieldset class="fieldset-section">
                <legend class="section-legend">Addresses</legend>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        {{ form_label(form.shippingAddress, null, {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.shippingAddress, {'attr': {'rows': 4, 'class': 'form-control'}}) }}
                    </div>
                    <div>
                        {{ form_label(form.billingAddress, null, {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.billingAddress, {'attr': {'rows': 4, 'class': 'form-control'}}) }}
                    </div>
                </div>
            </fieldset>

            <!-- Order Status Section -->
            <fieldset class="fieldset-section">
                <legend class="section-legend">Order Status</legend>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        {{ form_label(form.status, null, {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.status, {'attr': {'class': 'form-control'}}) }}
                    </div>
                    <div>
                        {{ form_label(form.paymentStatus, null, {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.paymentStatus, {'attr': {'class': 'form-control'}}) }}
                    </div>
                </div>
            </fieldset>

            <!-- Payment Section -->
            <fieldset class="fieldset-section">
                <legend class="section-legend">Payment Information</legend>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        {{ form_label(form.paymentMethod, null, {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.paymentMethod, {'attr': {'class': 'form-control'}}) }}
                    </div>
                    <div>
                        {{ form_label(form.shippingCost, null, {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.shippingCost, {'attr': {'class': 'form-control'}}) }}
                    </div>
                    <div>
                        {{ form_label(form.taxAmount, null, {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.taxAmount, {'attr': {'class': 'form-control'}}) }}
                    </div>
                    <div>
                        {{ form_label(form.discountAmount, null, {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.discountAmount, {'attr': {'class': 'form-control'}}) }}
                    </div>
                </div>
            </fieldset>

            <!-- Notes Section -->
            <fieldset class="fieldset-section">
                <legend class="section-legend">Additional Notes</legend>
                
                {{ form_label(form.notes, null, {'label_attr': {'class': 'form-label'}}) }}
                {{ form_widget(form.notes, {'attr': {'rows': 5, 'class': 'form-control'}}) }}
            </fieldset>

            <!-- Order Items Section (from form) -->
            {% if form.orderItems is defined and form.orderItems|length > 0 %}
            <fieldset class="fieldset-section">
                <legend class="section-legend">Order Items</legend>
                
                {% for item in form.orderItems %}
                <div class="bg-gray-50 rounded-lg p-4 mb-4 border border-[#EFCFB4]/30">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-sm font-semibold text-[#5E0B15]">Item #{{ loop.index }}</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div>
                            {{ form_label(item.product, null, {'label_attr': {'class': 'form-label'}}) }}
                            {{ form_widget(item.product, {'attr': {'class': 'form-control'}}) }}
                        </div>
                        <div>
                            {{ form_label(item.quantity, null, {'label_attr': {'class': 'form-label'}}) }}
                            {{ form_widget(item.quantity, {'attr': {'class': 'form-control'}}) }}
                        </div>
                        <div>
                            {{ form_label(item.unitPrice, null, {'label_attr': {'class': 'form-label'}}) }}
                            {{ form_widget(item.unitPrice, {'attr': {'class': 'form-control'}}) }}
                        </div>
                        <div>
                            {{ form_label(item.discount, null, {'label_attr': {'class': 'form-label'}}) }}
                            {{ form_widget(item.discount, {'attr': {'class': 'form-control'}}) }}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </fieldset>
            {% endif %}

            <!-- Form Actions -->
            <div class="flex gap-4 pt-4 border-t border-gray-200">
                <button type="submit"
                    class="px-8 py-3 rounded-xl font-semibold shadow-md transition-all duration-300 border bg-[#EFCFB4] text-[#7F1734] border-[#EFCFB4] hover:bg-[#7F1734] hover:text-white btn-hover">
                    ‚úì Update Order
                </button>
                <a href="{{ path('app_order_show', {'id': order.id}) }}"
                    class="px-8 py-3 rounded-xl font-semibold shadow-md transition-all duration-300 border bg-gray-300 text-gray-700 border-gray-300 hover:bg-gray-400 btn-hover text-center">
                    Cancel
                </a>
            </div>

            {{ form_end(form) }}
        </div>

        <!-- Order Items Section -->
        <div class="bg-white/90 backdrop-blur-sm border border-[#EFCFB4]/50 rounded-2xl shadow-md p-8 mb-8">
            <h2 class="text-2xl font-bold text-[#5E0B15] mb-6">Order Items</h2>

            {% if order.orderItems|length > 0 %}
                <div class="overflow-x-auto mb-8">
                    <table class="w-full">
                        <thead>
                            <tr class="bg-[#F8EAD8] border-b border-[#EFCFB4]">
                                <th class="px-4 py-2 text-left text-sm font-semibold">Product</th>
                                <th class="px-4 py-2 text-center text-sm font-semibold">Unit Price</th>
                                <th class="px-4 py-2 text-center text-sm font-semibold">Quantity</th>
                                <th class="px-4 py-2 text-right text-sm font-semibold">Subtotal</th>
                                <th class="px-4 py-2 text-center text-sm font-semibold">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in order.orderItems %}
                                <tr class="border-t border-[#EFCFB4]/30 hover:bg-[#F8EAD8]/50 transition-colors">
                                    <td class="px-4 py-3 text-sm text-gray-700">
                                        {{ item.product.name }}
                                    </td>
                                    <td class="px-4 py-3 text-sm text-center text-gray-700">
                                        ‚Ç±{{ item.unitPrice }}
                                    </td>
                                    <td class="px-4 py-3 text-sm text-center text-gray-700">
                                        {{ item.quantity }}
                                    </td>
                                    <td class="px-4 py-3 text-sm text-right font-semibold text-gray-800">
                                        ‚Ç±{{ item.subtotal }}
                                    </td>
                                    <td class="px-4 py-3 text-center">
                                        <form method="post" action="{{ path('app_order_remove_item', {'orderId': order.id, 'itemId': item.id}) }}" onsubmit="return confirm('Remove this item?');" class="inline">
                                            <input type="hidden" name="_token" value="{{ csrf_token('remove_item' ~ item.id) }}">
                                            <button type="submit" class="px-3 py-1 rounded text-xs font-semibold bg-red-100 text-red-700 hover:bg-red-200 transition-all duration-300">
                                                üóëÔ∏è Remove
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p class="text-gray-600 text-center py-8 mb-8">No items in this order yet.</p>
            {% endif %}

            <!-- Add Item Section -->
            <fieldset class="fieldset-section border-t border-gray-200 pt-6">
                <legend class="section-legend">Add Item to Order</legend>
                
                <form method="post" action="{{ path('app_order_add_item', {'id': order.id}) }}" class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                    <div>
                        <label class="form-label">Product</label>
                        <select name="product_id" class="form-control" required>
                            <option value="">-- Select a product --</option>
                            {% for product in products %}
                                <option value="{{ product.id }}">{{ product.name }} (‚Ç±{{ product.price }})</option>
                            {% else %}
                                <option value="" disabled>No products available</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="form-label">Quantity</label>
                        <input type="number" name="quantity" value="1" min="1" class="form-control" required>
                    </div>
                    <div>
                        <button type="submit" class="w-full px-6 py-2 rounded-lg font-semibold bg-[#EFCFB4] text-[#7F1734] border border-[#EFCFB4] hover:bg-[#7F1734] hover:text-white transition-all duration-300">
                            + Add Item
                        </button>
                    </div>
                </form>
            </fieldset>
        </div>
    </div>
</div>

<style>
    .form-control {
        width: 100%;
        padding: 0.5rem 0.75rem;
        border: 1px solid #EFCFB4;
        border-radius: 0.5rem;
        font-size: 1rem;
        transition: all 0.3s;
    }

    .form-control:focus {
        outline: none;
        border-color: #7F1734;
        box-shadow: 0 0 0 4px rgba(127, 23, 52, 0.1);
    }

    .form-label {
        display: block;
        font-size: 0.875rem;
        font-weight: 600;
        color: #5E0B15;
        margin-bottom: 0.5rem;
    }

    .fieldset-section {
        border-left: 4px solid #EFCFB4;
        padding-left: 1.5rem;
        padding-top: 1rem;
        padding-bottom: 1rem;
        margin-bottom: 1.5rem;
    }

    .section-legend {
        font-size: 1.125rem;
        font-weight: 700;
        color: #5E0B15;
        margin-bottom: 1rem;
        display: block;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #5E0B15;
        font-size: 0.875rem;
    }
</style>

{% endblock %}
